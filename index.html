<!DOCTYPE html>
<html lang="en,default">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"alstonzero.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="MyNote">
<meta property="og:url" content="https://alstonzero.github.io/index.html">
<meta property="og:site_name" content="MyNote">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="HOU YINGQIAO">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://alstonzero.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>MyNote</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MyNote</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/alstonzero" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en,default">
    <link itemprop="mainEntityOfPage" href="https://alstonzero.github.io/2021/01/02/k8s-Cluster%20Maintenance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HOU YINGQIAO">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MyNote">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/02/k8s-Cluster%20Maintenance/" class="post-title-link" itemprop="url">k8s-Cluster Maintenance</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-02 22:27:29 / Modified: 22:31:32" itemprop="dateCreated datePublished" datetime="2021-01-02T22:27:29+10:00">2021-01-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/k8s-udemy/" itemprop="url" rel="index"><span itemprop="name">k8s_udemy</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="k8s-Cluster-Maintenance"><a href="#k8s-Cluster-Maintenance" class="headerlink" title="k8s-Cluster Maintenance"></a>k8s-Cluster Maintenance</h1><h2 id="OS-Upgrades"><a href="#OS-Upgrades" class="headerlink" title="OS Upgrades"></a>OS Upgrades</h2><p>For example,you have a cluster with a few nodes and pods serving applications.If one of these nodes go down,the pods on that node are not accessible.</p>
<p>If the node came back online immediately,then the <code>kubectl</code> process starts and the pods come back.However,if the node was down for more than 5 mins,then the pods are terminated from that node.</p>
<h3 id="pod-eviction"><a href="#pod-eviction" class="headerlink" title="pod eviction:"></a>pod eviction:</h3><p>The time wait for a pod to come back.</p>
<p>Pod eviction is set on the controller manager</p>
<p><code>kube-controller-manager --pod-eviction-timeout=5m0s</code></p>
<p>When the node comes back online after the <strong>pod eviction</strong> timeout it comes up blank without any pods scheduled on it.</p>
<h3 id="Maintenance-a-node"><a href="#Maintenance-a-node" class="headerlink" title="Maintenance a node"></a>Maintenance a node</h3><p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/maint-os%20upgrade01.png"></p>
<ul>
<li><p><code>kubectl drain node-1</code>:</p>
<p>When you <strong>drain</strong>(æ”¾ç©ºï¼Œæ”¾å¹²) the node the pods are <strong>gracefully terminated</strong> from the node that theyâ€™re on and <strong>recreated on another</strong>.</p>
<p>The node is also cordoned or marked as <strong>unschedulable</strong>. Meaning no pods can be scheduled on this node until you specifically remove the restriction.</p>
</li>
<li><p><code>kubectl uncordon node-1</code>:</p>
<p><strong>Uncordon</strong> the node,so that pods can be scheduled on it again.</p>
</li>
<li><p><code>kubectl cordon node-2</code>:</p>
<p><strong>cordon</strong> simply marks a node <strong>unschedulable</strong>. Unlike drain it does <strong>not terminate or move</strong> the pods on an existing node.It simply make sure than new pods are not scheduled on that node.</p>
</li>
</ul>
<h3 id="Practice"><a href="#Practice" class="headerlink" title="Practice"></a>Practice</h3><ul>
<li><p>On which nodes are the applications hosted on?</p>
<p>Run the command <code>kubectl get pods -o wide</code> and get the list of nodes the pods are placed on</p>
</li>
<li><p>We need to take <code>node01</code> out for maintenance. Empty the node of all applications and mark it unschedulable.</p>
<p><code>kubectl drain node01 --ignore-daemonsets</code></p>
</li>
<li><p>The maintenance tasks have been completed. Configure the node to be schedulable again.</p>
<p><code>kubectl uncordon node01</code></p>
</li>
<li><p>Why are there no pods placed on the <code>master</code> node?</p>
<p>Use the command <code>kubectl describe node master/controlplane</code></p>
</li>
<li><p>Node03 has our critical applications. We do not want to schedule any more apps on node03. Mark <code>node03</code> as <code>unschedulable</code> but do not remove any apps currently running on it .</p>
<p><code>kubectl cordon node03</code></p>
</li>
</ul>
<h3 id="kubernetes-Release"><a href="#kubernetes-Release" class="headerlink" title="kubernetes Release"></a>kubernetes Release</h3><p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/maint-osupgrade02.png"></p>
<p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/maint-osupgrade03.png"></p>
<ul>
<li><p>alpha release: The features are disabled by default and maybe buggy.</p>
</li>
<li><p>beta release: The code is well tested.</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/maint-osupgrade04.png"></p>
<p>The <strong>ETCD</strong> and <strong>CoreDNS</strong> servers have their own versions as they are separate projects.</p>
<h3 id="Cluster-Upgrade-Process"><a href="#Cluster-Upgrade-Process" class="headerlink" title="Cluster Upgrade Process"></a>Cluster Upgrade Process</h3><h4 id="Component-Version"><a href="#Component-Version" class="headerlink" title="Component Version"></a>Component Version</h4><p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/maint-osupgrade05.png"></p>
<p>The kube-apiserver is the primary component.</p>
<p><strong>None of the other components</strong> should ever be at a version <strong>higher than</strong> the kube-apiserver the controller.</p>
<p>So if kube-apiserver was at <code>X</code> ,Controller-manager and kube-scheduler can be at <code>X-1</code> and the kubelet and kube-proxy components can be at <code>X-2</code>.</p>
<h4 id="Upgrade-Step"><a href="#Upgrade-Step" class="headerlink" title="Upgrade Step"></a>Upgrade Step</h4><p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/maint-osupgrade06.png"></p>
<p>We cannot upgrade directly from 1.10 to 1.13. We should upgrade one minor version at a time.(v1.10 to 1.11 to 1.12 to 1.13.)</p>
<h4 id="kubeadm-upgrade"><a href="#kubeadm-upgrade" class="headerlink" title="kubeadm upgrade"></a>kubeadm upgrade</h4><h4 id="upgrade-master-node"><a href="#upgrade-master-node" class="headerlink" title="upgrade master node"></a>upgrade master node</h4><p><code>kubeadm upgrade plan</code>:Check the latest stable version available for upgrade</p>
<p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/maint-osupgrade07.png"></p>
<p>The master node version is still v1.11.3.</p>
<p>This is because in the output of this command it is showing the <strong>versions of <code>kubelet</code></strong> on each of these nodes registered with the API server and <strong>not the version of the kube-apiserver</strong> itself.</p>
<ul>
<li>Then upgrade <code>kubelet</code></li>
</ul>
<p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/maint-osupgrade08.png"></p>
<h4 id="upgrade-worker-node"><a href="#upgrade-worker-node" class="headerlink" title="upgrade worker node"></a>upgrade worker node</h4><ul>
<li><p>upgrade node01</p>
<p><code>kubectl drain node01</code></p>
<p><code>ssh node01</code></p>
<p><code>apt-get upgrade -y kubeadm=1.12.0-00</code></p>
<p><code>apt-get upgrade -y kubelet=1.12.0-00</code></p>
<p><code>kubeadm upgrade node </code></p>
<p><code>systemctl restart kubelet</code></p>
<p><code>kubectl uncordon node-1</code></p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/maint-osupgrade09.png"></p>
<ul>
<li>node02 : same as the upgarde of node01</li>
<li>node03</li>
</ul>
<h3 id="Practice-1"><a href="#Practice-1" class="headerlink" title="Practice"></a>Practice</h3><ul>
<li><p>What is the latest stable version available for upgrade?Use <code>kubeadm</code> tool</p>
<p><code>kubeadm upgrade plan</code></p>
</li>
<li><p>We will be upgrading the master node first. Drain the master node of workloads and mark it <code>UnSchedulable</code></p>
<p><code>kubectl drain master/controlplane --ignore-daemonsets</code>  </p>
</li>
<li><p>Upgrade the master/controlplane components to exact version <code>v1.19.0</code></p>
<p>Upgrade kubeadm tool (if not already), then the master components, and finally the kubelet. Practice referring to the kubernetes documentation page. Note: While upgrading kubelet, if you hit dependency issue while running the <code>apt-get upgrade kubelet</code> command, use the <code>apt install kubelet=1.19.0-00</code> command instead</p>
<p><code>apt update</code></p>
<p><code>apt install -y kubeadm=1.19.0-00</code></p>
<p><code>kubeadm upgrade apply v1.19.0</code></p>
<p><code>apt install -y kubelet=1.19.0-00</code></p>
<p><code>systemctl restart kubelet</code></p>
</li>
</ul>
<h3 id="Backup-and-Restore-Methods"><a href="#Backup-and-Restore-Methods" class="headerlink" title="Backup and Restore Methods"></a>Backup and Restore Methods</h3><h4 id="Query-kube-apiserver"><a href="#Query-kube-apiserver" class="headerlink" title="Query kube-apiserver"></a>Query kube-apiserver</h4><p>A better approach to backing up resource configuration is to use query the kube-apiserver</p>
<ul>
<li><p>use <code>kubectl</code> to backup resources</p>
<p><code>kubectl get all --all-namespaces -o yaml &gt; all-deploy-services.yaml</code></p>
</li>
</ul>
<h4 id="Backup-ETCD"><a href="#Backup-ETCD" class="headerlink" title="Backup - ETCD"></a>Backup - ETCD</h4><p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/maint-osupgrade10.png"></p>
<ul>
<li><p>Take snapshot of etcd database (named snapshot.db)</p>
<p><code>ETCDCTL_API=3 etcdctl snapshot save snapshot.db</code></p>
</li>
<li><p>View the status of the backup</p>
<p><code>ETCDCTL_API=3 etcdctl snapshot status snapshot.db</code></p>
</li>
</ul>
<h4 id="Restore-ETCD"><a href="#Restore-ETCD" class="headerlink" title="Restore-ETCD"></a>Restore-ETCD</h4><p>When ETCD restores from a backup, it initializes a new cluster configuration and configures the members of ETCD as new members to a new cluster.</p>
<p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/maint-osupgrade11.png"></p>
<ul>
<li><p>Use <code>etcdctl restore</code> command</p>
</li>
<li><p>Set <code>--data-dir</code></p>
</li>
<li><p><code>--initial-cluster-token</code>:This is to prevent a new member from accidentally joining an existing cluster.</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en,default">
    <link itemprop="mainEntityOfPage" href="https://alstonzero.github.io/2021/01/02/k8s-etcdctl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HOU YINGQIAO">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MyNote">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/02/k8s-etcdctl/" class="post-title-link" itemprop="url">k8s-Working with ETCDCTL</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-02 22:27:29 / Modified: 22:23:01" itemprop="dateCreated datePublished" datetime="2021-01-02T22:27:29+10:00">2021-01-02</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/k8s-udemy/" itemprop="url" rel="index"><span itemprop="name">k8s_udemy</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Working-with-ETCDCTL"><a href="#Working-with-ETCDCTL" class="headerlink" title="Working with ETCDCTL"></a>Working with ETCDCTL</h1><p><code>etcdctl</code> is a command line client for <a target="_blank" rel="noopener" href="https://github.com/coreos/etcd"><strong>etcd</strong></a>.</p>
<p>In all our Kubernetes Hands-on labs, the ETCD key-value database is deployed as a static pod on the master. The version used is v3.</p>
<p>To make use of <code>etcdctl</code> for tasks such as back up and restore, make sure that you set the <code>ETCDCTL_API</code> to 3.</p>
<p>You can do this by exporting the variable ETCDCTL_API prior to using the etcdctl client. This can be done as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ETCDCTL_API&#x3D;3</span><br></pre></td></tr></table></figure>

<p>On the <strong>Master Node</strong>:</p>
<p><img src="https://process.fs.teachablecdn.com/ADNupMnWyR7kCWRvm76Laz/resize=width:1000/https://www.filepicker.io/api/file/T7Y4a6aUTyOy9W2ZpfeV" alt="img"></p>
<p>To see all the options for a specific sub-command, make use of the <strong><code>-h</code> or <code>--help</code></strong> flag.</p>
<p>For example, if you want to take a snapshot of etcd, use:</p>
<p><code>etcdctl snapshot save -h</code> and keep a note of the mandatory global options.</p>
<p>Since our ETCD database is TLS-Enabled, the following options are mandatory:</p>
<ul>
<li><p><code>--cacert</code>                                                </p>
<p>verify certificates of TLS-enabled secure servers using this CA bundle</p>
</li>
<li><p><code>--cert</code>                                                    </p>
<p>identify secure client using this TLS certificate file</p>
</li>
<li><p><code>--endpoints=[127.0.0.1:2379]</code>          </p>
<p>This is the default as ETCD is running on master node and exposed on localhost 2379.</p>
</li>
<li><p><code>--key</code>                                                      </p>
<p>identify secure client using this TLS key file</p>
</li>
</ul>
<p>Similarly use the help option for <strong>snapshot restore</strong> to see all available options for restoring the backup.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">etcdctl snapshot restore -h</span><br></pre></td></tr></table></figure>

<p>For a detailed explanation on how to make use of the etcdctl command line tool and work with the -h flags, check out the solution video for the Backup and Restore Lab.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en,default">
    <link itemprop="mainEntityOfPage" href="https://alstonzero.github.io/2020/12/30/Kubernetes%20%E3%81%AE%E5%9F%BA%E7%A4%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HOU YINGQIAO">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MyNote">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/30/Kubernetes%20%E3%81%AE%E5%9F%BA%E7%A4%8E/" class="post-title-link" itemprop="url">Kubernetes ã®åŸºç¤</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-30 22:27:29" itemprop="dateCreated datePublished" datetime="2020-12-30T22:27:29+10:00">2020-12-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-03 22:04:21" itemprop="dateModified" datetime="2021-01-03T22:04:21+10:00">2021-01-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/k8s%E3%82%AC%E3%82%A4%E3%83%89%E3%83%96%E3%83%83%E3%82%AF/" itemprop="url" rel="index"><span itemprop="name">k8sã‚¬ã‚¤ãƒ‰ãƒ–ãƒƒã‚¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Kubernetes-ã®åŸºç¤"><a href="#Kubernetes-ã®åŸºç¤" class="headerlink" title="Kubernetes ã®åŸºç¤"></a>Kubernetes ã®åŸºç¤</h2><p>Kubernetes ã¯ã€Kubernetes Master ã¨ Kubernetes Node ã® 2 ç¨®é¡ã®ãƒãƒ¼ãƒ‰ã‹ã‚‰æˆã‚Šç«‹ã£ã¦ã„ã¾ã™ã€‚</p>
<p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/k8s-guidebook-images/4-1.png"></p>
<p>CLI ãƒ„ãƒ¼ãƒ«ã®kubectl ã¯ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ<code>.yaml</code>,<code>.yml</code>,<code>.json</code>ï¼‰ã®æƒ…å ±ã‚’å…ƒã«Kubernetes Master ãŒæŒã¤ API ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã“ã¨ã§ Kubernetes ã‚’æ“ä½œã—ã¾ã™ã€‚</p>
<p>ã¾ãŸã€Kubernetesã€€Master ã® API ã¯ã€ä¸€èˆ¬çš„ãª RESTful API ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€å„ç¨®ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨€èªã® RESTful API ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„<code> curl</code> ãªã©ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦ã€ç›´æ¥ API ã‚’å‘¼ã³å‡ºã—ã¦ Kubernetes ã‚’æ“ä½œã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚</p>
<h3 id="Kubernetes-ã¨ãƒªã‚½ãƒ¼ã‚¹"><a href="#Kubernetes-ã¨ãƒªã‚½ãƒ¼ã‚¹" class="headerlink" title="Kubernetes ã¨ãƒªã‚½ãƒ¼ã‚¹"></a>Kubernetes ã¨ãƒªã‚½ãƒ¼ã‚¹</h3><p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/k8s-guidebook-images/4-2t.png"></p>
<h4 id="Workloads-APIs-ãƒªã‚½ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™"><a href="#Workloads-APIs-ãƒªã‚½ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™" class="headerlink" title="Workloads APIs ãƒªã‚½ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™"></a>Workloads APIs ãƒªã‚½ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™</h4><p>â— Pod<br>â— ReplicationController<br>â— ReplicaSet<br>â— Deployment<br>â— DaemonSet<br>â— StatefulSet<br>â— Job<br>â— CronJob</p>
<h4 id="Service-APIs-ã‚«ãƒ†ã‚´ãƒª"><a href="#Service-APIs-ã‚«ãƒ†ã‚´ãƒª" class="headerlink" title="Service APIs ã‚«ãƒ†ã‚´ãƒª"></a>Service APIs ã‚«ãƒ†ã‚´ãƒª</h4><p>Service APIs ã‚«ãƒ†ã‚´ãƒªã¯ã€ã‚³ãƒ³ãƒ†ãƒŠã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªã‚„ã€ã‚¯ãƒ©ã‚¹ã‚¿ã®å¤–éƒ¨ã‹ã‚‰ã‚‚ã‚¢<br>ã‚¯ã‚»ã‚¹å¯èƒ½ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãªã©ã‚’æä¾›ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã§ã™ã€‚</p>
<p>â— Service<br>ãƒ» ClusterIP<br>ãƒ» ExternalIPï¼ˆClusterIP ã®ä¸€ç¨®ï¼‰<br>ãƒ» NodePort<br>ãƒ» LoadBalancer<br>ãƒ» Headlessï¼ˆNoneï¼‰<br>ãƒ» ExternalName<br>ãƒ» None-Selector<br>â— Ingres</p>
<h4 id="Config-ï¼†-Storage-APIs-ã‚«ãƒ†ã‚´ãƒª"><a href="#Config-ï¼†-Storage-APIs-ã‚«ãƒ†ã‚´ãƒª" class="headerlink" title="Config ï¼† Storage APIs ã‚«ãƒ†ã‚´ãƒª"></a>Config ï¼† Storage APIs ã‚«ãƒ†ã‚´ãƒª</h4><p>Config ï¼† Storage APIs ã‚«ãƒ†ã‚´ãƒªã¯ã€è¨­å®šã‚„æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«åŸ‹ã‚è¾¼ã‚“ã ã‚Šã€æ°¸ç¶šãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’æä¾›ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã§ã™ã€‚</p>
<p>â— Secret<br>â— ConfigMap<br>â— PersistentVolumeClaim</p>
<h4 id="Cluster-APIs-ã‚«ãƒ†ã‚´ãƒª"><a href="#Cluster-APIs-ã‚«ãƒ†ã‚´ãƒª" class="headerlink" title="Cluster APIs ã‚«ãƒ†ã‚´ãƒª"></a>Cluster APIs ã‚«ãƒ†ã‚´ãƒª</h4><p>ã‚¯ãƒ©ã‚¹ã‚¿è‡ªä½“ã®æŒ¯ã‚‹èˆã„ã‚’å®šç¾©ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã§ã™ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘¨ã‚Šã®è¨­å®šã‚„ãƒãƒªã‚·ãƒ¼ã€ã‚¯ãƒ©ã‚¹ã‚¿ã®ç®¡ç†æ€§ã‚’é«˜ã‚ã‚‹æ©Ÿèƒ½ã®ãŸã‚ã®ãƒªã‚½ãƒ¼ã‚¹ãªã©ã€æ§˜ã€…ãªãƒªã‚½ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚</p>
<p>â— Node<br>â— Namespace<br>â— PersistentVolume<br>â— ResourceQuota<br>â— ServiceAccount<br>â— Role<br>â— ClusterRole<br>â— RoleBinding<br>â— ClusterRoleBinding<br>â— NetworkPolicy</p>
<h4 id="Metadata-APIs-ã‚«ãƒ†ã‚´ãƒª"><a href="#Metadata-APIs-ã‚«ãƒ†ã‚´ãƒª" class="headerlink" title="Metadata APIs ã‚«ãƒ†ã‚´ãƒª"></a>Metadata APIs ã‚«ãƒ†ã‚´ãƒª</h4><p>ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã®å‹•ä½œã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®ãƒªã‚½ãƒ¼ã‚¹ã§ã™ã€‚</p>
<p>ä¾‹ãˆã°ã€Pod ã‚’ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã•ã›ã‚‹ãŸã‚ã«åˆ©ç”¨ã•ã‚Œã‚‹ HorizontalPodAutoscaler ã¯ã€Deployment ãƒªã‚½ãƒ¼ã‚¹ã‚’æ“ä½œã—ã¦ãƒ¬ãƒ—ãƒªã‚«æ•°ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚</p>
<p>â— LimitRange<br>â— HorizontalPodAutoscaler<br>â— PodDisruptionBudget<br>â— CustomResourceDefinition</p>
<h3 id="åˆæœŸçŠ¶æ…‹ã®Namespace"><a href="#åˆæœŸçŠ¶æ…‹ã®Namespace" class="headerlink" title="åˆæœŸçŠ¶æ…‹ã®Namespace"></a>åˆæœŸçŠ¶æ…‹ã®Namespace</h3><p>â— kube-system<br>ãƒ» Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚„ã‚¢ãƒ‰ã‚ªãƒ³ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ Namespace<br>â— kube-public<br>ãƒ» å…¨ãƒ¦ãƒ¼ã‚¶ãŒåˆ©ç”¨ã§ãã‚‹ ConfigMap ãªã©ã‚’é…ç½®ã™ã‚‹ Namespace<br>â— kube-node-lease<br>ãƒ» Kubernetes Node ã®ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆæƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã® Lease ãƒªã‚½ãƒ¼ã‚¹ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹å°‚ç”¨ã® Namespace ã§ã™ã€‚<br>â— default<br>ãƒ» ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® Namespaceã€ãƒ¦ãƒ¼ã‚¶ãŒä»»æ„ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ç™»éŒ²ã™ã‚‹ã®ã«ä½¿ç”¨ã§ãã¾ã™</p>
<h3 id="RBACï¼ˆRole-Based-Access-Controlï¼‰"><a href="#RBACï¼ˆRole-Based-Access-Controlï¼‰" class="headerlink" title="RBACï¼ˆRole-Based Access Controlï¼‰"></a>RBACï¼ˆRole-Based Access Controlï¼‰</h3><p>RBAC ã¯ã€å›³ 4.2 ã®ã‚ˆã†ã«ã‚¯ãƒ©ã‚¹ã‚¿æ“ä½œã«é–¢ã™ã‚‹æ¨©é™ã‚’ Namespace ã”ã¨ã«åˆ†ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã»ã‹ã€Network Policy ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ Namespace é–“ã®é€šä¿¡ã®åˆ¶å¾¡ã‚’è¡Œãˆã‚‹ä»•çµ„ã¿ã§ã™</p>
<p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/k8s-guidebook-images/4-2.png"></p>
<h3 id="CLI-ãƒ„ãƒ¼ãƒ«-kubectl"><a href="#CLI-ãƒ„ãƒ¼ãƒ«-kubectl" class="headerlink" title="CLI ãƒ„ãƒ¼ãƒ« kubectl"></a>CLI ãƒ„ãƒ¼ãƒ« kubectl</h3><p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/k8s-guidebook-images/4-3.png" alt="1609324451333"></p>
<p>æ‰‹å‹•ï¼škubectl </p>
<p>ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª</p>
<h4 id="èªè¨¼æƒ…å ±ã¨-Contextï¼ˆconfigï¼‰"><a href="#èªè¨¼æƒ…å ±ã¨-Contextï¼ˆconfigï¼‰" class="headerlink" title="èªè¨¼æƒ…å ±ã¨ Contextï¼ˆconfigï¼‰"></a>èªè¨¼æƒ…å ±ã¨ Contextï¼ˆconfigï¼‰</h4><p>kubectl ãŒ Kubernetes Master ã¨é€šä¿¡ã™ã‚‹éš›ã«ã¯ã€æ¥ç¶šå…ˆã‚µãƒ¼ãƒã®æƒ…å ±ã‚„èªè¨¼æƒ…å ±ãªã©ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚</p>
<p>kubectl ã¯ kubeconfigï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯<code>~/.kube/config</code>ï¼‰ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦<br>æ¥ç¶šã‚’è¡Œã„ã¾ã™ã€‚</p>
<p>kubeconfig ã§å…·ä½“çš„ã«è¨­å®šã‚’è¡Œã†éƒ¨åˆ†ã¯ã€<code>clusters</code> ï¼ <code>users</code> ï¼ <code>contexts</code> ã® 3 ç¨®é¡ã®é…åˆ—å‹ã§ã™ã€‚è¤‡æ•°ã®å¯¾è±¡ã‚’ç™»éŒ²ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
<h4 id="kubeconfigã®sample"><a href="#kubeconfigã®sample" class="headerlink" title="kubeconfigã®sample"></a>kubeconfigã®sample</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Config</span></span><br><span class="line"><span class="attr">preferences:</span> &#123;&#125;</span><br><span class="line"><span class="attr">clusters:</span> <span class="comment"># æ¥ç¶šå…ˆã‚¯ãƒ©ã‚¹ã‚¿</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sample-cluster</span></span><br><span class="line">  <span class="attr">cluster:</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">https://localhost:6443</span></span><br><span class="line"><span class="attr">users:</span> <span class="comment"># èªè¨¼æƒ…å ±</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sample-user</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">client-certificate-data:</span> <span class="string">LS0tLS1CRUdJTi...</span></span><br><span class="line">    <span class="attr">client-key-data:</span> <span class="string">LS0tLS1CRUdJTi...</span></span><br><span class="line"><span class="attr">contexts:</span> <span class="comment"># æ¥ç¶šå…ˆã¨èªè¨¼æƒ…å ±ã®çµ„ã¿åˆã‚ã›</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sample-context</span></span><br><span class="line">  <span class="attr">context:</span></span><br><span class="line">    <span class="attr">cluster:</span> <span class="string">sample-cluster</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">sample-user</span></span><br><span class="line"><span class="attr">current-context:</span> <span class="string">sample-context</span></span><br></pre></td></tr></table></figure>

<p>contexts ã«ã¯ã€<code>cluster</code> ã¨ <code>user</code> ã®ãƒšã‚¢ã¨ <code>namespace</code> ã‚’æŒ‡å®šã—ãŸã‚‚ã®ã‚’å®šç¾©ã—ã¾ã™ã€‚</p>
<p><img src="https://raw.githubusercontent.com/alstonzero/k8s_Learning/master/pic/k8s-guidebook-images/4-4.png"></p>
<h4 id="kubeconfigã®è¨­å®šå¤‰æ›´"><a href="#kubeconfigã®è¨­å®šå¤‰æ›´" class="headerlink" title="kubeconfigã®è¨­å®šå¤‰æ›´"></a>kubeconfigã®è¨­å®šå¤‰æ›´</h4><ul>
<li><p>ã‚¯ãƒ©ã‚¹ã‚¿ï¼ˆprd-clusterï¼‰ã®å®šç¾©ã‚’è¿½åŠ ãƒ»å¤‰æ›´</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-cluster prd-cluster --server&#x3D;https:&#x2F;&#x2F;localhost:6443</span><br></pre></td></tr></table></figure>
</li>
<li><p>èªè¨¼æƒ…å ±ã®å®šç¾©ã‚’è¿½åŠ ãƒ»å¤‰æ›´</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-credentials admin-user \</span><br><span class="line">   --client-certificate=./sample.crt\</span><br><span class="line">   --client-key=./sample.key \</span><br><span class="line">   --embed-certs=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Contextã®å®šç¾©ï¼ˆã‚¯ãƒ©ã‚¹ã‚¿clusterï¼èªè¨¼æƒ…å ±userï¼Namespaceã‚’å®šç¾©ï¼‰ã‚’è¿½åŠ ãƒ»å¤‰æ›´</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-context prd-admin \</span><br><span class="line">  --cluster=prd-cluster \</span><br><span class="line">  --user=admin-user \</span><br><span class="line">  --namespace=default</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>kubectl ã¯ Contextï¼ˆcurrent-contextï¼‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã«ã‚ˆã‚Šã€è¤‡æ•°ã®ç’°å¢ƒã‚’è¤‡æ•°ã®æ¨©é™ã§æ“ä½œã§ãã‚‹ã€‚</p>
<ul>
<li><p>Contextã®ä¸€è¦§ã‚’è¡¨ç¤º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config get-contexts</span><br></pre></td></tr></table></figure>
</li>
<li><p>Contextã®åˆ‡ã‚Šæ›¿ãˆ <code>use-context</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context prd-admin</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¾åœ¨ã®Contextã‚’è¡¨ç¤º</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config current-context</span><br></pre></td></tr></table></figure>
</li>
<li><p>ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œã”ã¨ã«Contextã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl --context prd-admin get pod</span><br></pre></td></tr></table></figure>



</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en,default">
    <link itemprop="mainEntityOfPage" href="https://alstonzero.github.io/2020/12/29/kind%EF%BC%88Kubernetes%20in%20Docker%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HOU YINGQIAO">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MyNote">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/29/kind%EF%BC%88Kubernetes%20in%20Docker%EF%BC%89/" class="post-title-link" itemprop="url">kindï¼ˆKubernetes in Dockerï¼‰</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-29 22:27:29" itemprop="dateCreated datePublished" datetime="2020-12-29T22:27:29+10:00">2020-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 22:07:19" itemprop="dateModified" datetime="2020-12-31T22:07:19+10:00">2020-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/k8s%E3%82%AC%E3%82%A4%E3%83%89%E3%83%96%E3%83%83%E3%82%AF/" itemprop="url" rel="index"><span itemprop="name">k8sã‚¬ã‚¤ãƒ‰ãƒ–ãƒƒã‚¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="kindï¼ˆKubernetes-in-Dockerï¼‰"><a href="#kindï¼ˆKubernetes-in-Dockerï¼‰" class="headerlink" title="kindï¼ˆKubernetes in Dockerï¼‰"></a>kindï¼ˆKubernetes in Dockerï¼‰</h2><h3 id="kindã®ä»•çµ„ã¿ï¼š"><a href="#kindã®ä»•çµ„ã¿ï¼š" class="headerlink" title="kindã®ä»•çµ„ã¿ï¼š"></a>kindã®ä»•çµ„ã¿ï¼š</h3><p>Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’è¤‡æ•°å€‹èµ·å‹•ã—ã€ãã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ Kubernetes Node ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€è¤‡æ•°å°æ§‹æˆã® Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>
<p><img src="C:\Users\alston\AppData\Roaming\Typora\typora-user-images\1609237896022.png" alt="1609237896022"></p>
<p><a target="_blank" rel="noopener" href="https://kind.sigs.k8s.io/docs/user/quick-start/#installation">kindã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.9.0/kind-linux-amd64</span><br><span class="line">chmod +x ./kind</span><br><span class="line">mv ./kind /usr/<span class="built_in">local</span>/bin/kind</span><br></pre></td></tr></table></figure>

<h3 id="ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ§‹ç¯‰ï¼š"><a href="#ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ§‹ç¯‰ï¼š" class="headerlink" title="ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ§‹ç¯‰ï¼š"></a>ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ§‹ç¯‰ï¼š</h3><p>Master3 å°ãƒ»Worker3 å°ã®æ§‹æˆã‚’æŒ‡å®šã™ã‚‹</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">kindest/node:v1.18.2</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">kindest/node:v1.18.2</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">kindest/node:v1.18.2</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">kindest/node:v1.18.2</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">kindest/node:v1.18.2</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">kindest/node:v1.18.2</span></span><br></pre></td></tr></table></figure>

<p>å®Ÿéš›ã«ã‚¯ãƒ©ã‚¹ã‚¿ã‚’æ§‹ç¯‰ã™ã‚‹ã«ã¯ã€å…ˆã»ã©ã®æ§‹æˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦<code>kind create cluster</code>ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚<code>--config</code>ã¯å®£è¨€ãƒ•ã‚¡ã‚¤ãƒ«ã®æŒ‡å®šã€‚ <code>--name</code>ã¯ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åã®æŒ‡å®šã€‚</p>
<p> <a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/issues/82399">åå‰ã¯ lower case alphanumeric charactersã®å¿…è¦ãŒã‚ã‚‹</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kind create cluster --config kind.yaml --name kindcluster</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Creating cluster &quot;kindcluster&quot; ...</span><br><span class="line"> âœ“ Ensuring node image (kindest&#x2F;node:v1.18.2) ğŸ–¼ </span><br><span class="line"> âœ“ Preparing nodes ğŸ“¦ ğŸ“¦ ğŸ“¦ ğŸ“¦ ğŸ“¦ ğŸ“¦  </span><br><span class="line"> âœ“ Configuring the external load balancer âš–ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ </span><br><span class="line"> âœ“ Writing configuration ğŸ“œ </span><br><span class="line"> âœ“ Starting control-plane ğŸ•¹ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ï¸ </span><br><span class="line"> âœ“ Installing CNI ğŸ”Œ </span><br><span class="line"> âœ“ Installing StorageClass ğŸ’¾ </span><br><span class="line"> âœ“ Joining more control-plane nodes ğŸ® </span><br><span class="line"> âœ“ Joining worker nodes ğŸšœ </span><br><span class="line">Set kubectl context to &quot;kind-kindcluster&quot;</span><br><span class="line">You can now use your cluster with:</span><br><span class="line"></span><br><span class="line">kubectl cluster-info --context kind-kindcluster</span><br><span class="line"></span><br><span class="line">Thanks for using kind! ğŸ˜Š</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>è¤‡æ•°ã® Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã«ã¯ã€<code>kubectl</code> ã® Context ã‚’åˆ‡ã‚Šæ›¿ãˆã¦åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl config use-context kind-kindcluster</span><br><span class="line">Switched to context <span class="string">&quot;kind-kindcluster&quot;</span>.</span><br></pre></td></tr></table></figure>

<ul>
<li>ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã§èµ·å‹•ã—ã¦ã„ã‚‹ Docker ã‚³ãƒ³ãƒ†ãƒŠãŒ Kubernetes Node ã¨ã—ã¦èªè­˜ã•ã‚Œã¦ã„ã¾ã™</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get nodes</span><br><span class="line">NAME                         STATUS   ROLES    AGE     VERSION</span><br><span class="line">kindcluster-control-plane    Ready    master   3h58m   v1.18.2</span><br><span class="line">kindcluster-control-plane2   Ready    master   3h57m   v1.18.2</span><br><span class="line">kindcluster-control-plane3   Ready    master   3h57m   v1.18.2</span><br><span class="line">kindcluster-worker           Ready    &lt;none&gt;   3h56m   v1.18.2</span><br><span class="line">kindcluster-worker2          Ready    &lt;none&gt;   3h56m   v1.18.2</span><br><span class="line">kindcluster-worker3          Ready    &lt;none&gt;   3h56m   v1.18.2</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨ã€ãƒãƒ¼ãƒ‰ã®å°æ•°åˆ†ã‚³ãƒ³ãƒ†ãƒŠãŒç¢ºèªã§ãã¾ã™ã€‚</p>
</li>
<li><p>Kubernetes Master ã®å†—é•·æ§‹æˆã®ãŸã‚ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ HAProxy ã‚‚ç¢ºèªã§ãã¾ã™</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE                                COMMAND                  CREATED             STATUS              PORTS                       NAMES</span><br><span class="line">758a3b2dbb76        kindest&#x2F;haproxy:v20200708-548e36db   &quot;&#x2F;docker-entrypoint.â€¦&quot;   4 hours ago         Up 4 hours          127.0.0.1:42909-&gt;6443&#x2F;tcp   kindcluster-external-load-balancer</span><br><span class="line">6e0965c46027        kindest&#x2F;node:v1.18.2                 &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;entrâ€¦&quot;   4 hours ago         Up 4 hours          127.0.0.1:39285-&gt;6443&#x2F;tcp   kindcluster-control-plane3</span><br><span class="line">d60c91ca4926        kindest&#x2F;node:v1.18.2                 &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;entrâ€¦&quot;   4 hours ago         Up 4 hours                                      kindcluster-worker2</span><br><span class="line">74df5e7b84cc        kindest&#x2F;node:v1.18.2                 &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;entrâ€¦&quot;   4 hours ago         Up 4 hours                                      kindcluster-worker</span><br><span class="line">3bcd661140e3        kindest&#x2F;node:v1.18.2                 &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;entrâ€¦&quot;   4 hours ago         Up 4 hours          127.0.0.1:46389-&gt;6443&#x2F;tcp   kindcluster-control-plane</span><br><span class="line">6396d431ea32        kindest&#x2F;node:v1.18.2                 &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;entrâ€¦&quot;   4 hours ago         Up 4 hours                                      kindcluster-worker3</span><br><span class="line">b32b5615b46f        kindest&#x2F;node:v1.18.2                 &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;entrâ€¦&quot;   4 hours ago         Up 4 hours          127.0.0.1:40325-&gt;6443&#x2F;tcp   kindcluster-control-plane2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’å–å¾—ã™ã‚‹</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kind get clusters </span><br></pre></td></tr></table></figure>

<ul>
<li>kindclusterã‚’å‰Šé™¤ã™ã‚‹</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kind delete cluster --name kindcluster</span><br></pre></td></tr></table></figure>

<h3 id="kindã®å†…éƒ¨ï¼š"><a href="#kindã®å†…éƒ¨ï¼š" class="headerlink" title="kindã®å†…éƒ¨ï¼š"></a>kindã®å†…éƒ¨ï¼š</h3><p>kind ã¯å†…éƒ¨ã§ kubeadmã¨ã„ã†æ§‹ç¯‰ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦ãŠã‚Šã€æ§‹ç¯‰æ™‚ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ãƒ‘ãƒƒãƒã‚’å½“ã¦ã‚‹<code>kubeadmConfigPatches</code>ã¨<code>kubeadmConfigPatchesJson6902</code>ãªã©ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§æ§˜ã€…ãªã‚¯ãƒ©ã‚¹ã‚¿ãŒæ§‹ç¯‰ã§ãã¾ã™ã€‚</p>
<p>ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã‹ã‚‰å†…éƒ¨ã®ã‚³ãƒ³ãƒ†ãƒŠã¸ã®ç–é€šæ€§ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã®<code>extraPortMapping</code>ãªã©ã®è¨­å®šã‚‚ã‚ˆãåˆ©ç”¨ã™ã‚‹ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en,default">
    <link itemprop="mainEntityOfPage" href="https://alstonzero.github.io/2020/12/16/k8s-A%20quick%20note%20on%20editing%20PODs%20and%20Deployments/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HOU YINGQIAO">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MyNote">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/16/k8s-A%20quick%20note%20on%20editing%20PODs%20and%20Deployments/" class="post-title-link" itemprop="url">k8s-A quick note on editing PODs and Deployments</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-16 22:27:29" itemprop="dateCreated datePublished" datetime="2020-12-16T22:27:29+10:00">2020-12-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 00:10:13" itemprop="dateModified" datetime="2020-12-31T00:10:13+10:00">2020-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/k8s-udemy/" itemprop="url" rel="index"><span itemprop="name">k8s_udemy</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="A-quick-note-on-editing-PODs-and-Deployments"><a href="#A-quick-note-on-editing-PODs-and-Deployments" class="headerlink" title="A quick note on editing PODs and Deployments"></a>A quick note on editing PODs and Deployments</h1><h4 id="Edit-a-POD"><a href="#Edit-a-POD" class="headerlink" title="Edit a POD"></a>Edit a POD</h4><p>Remember, you CANNOT edit specifications of an existing POD other than the below.</p>
<ul>
<li>spec.containers[*].image</li>
<li>spec.initContainers[*].image</li>
<li>spec.activeDeadlineSeconds</li>
<li>spec.tolerations</li>
</ul>
<p>For example you cannot edit the environment variables, service accounts, resource limits (all of which we will discuss later) of a running pod. But if you really want to, you have 2 options:</p>
<ol>
<li>Run the <code>kubectl edit pod &lt;pod name&gt;</code> command.  This will open the pod specification in an editor (vi editor). Then edit the required properties. When you try to save it, you will be denied. This is because you are attempting to edit a field on the pod that is not editable.</li>
</ol>
<p><img src="https://img-a.udemycdn.com/redactor/raw/2019-05-30_14-46-21-89ea56fea6b993ee0ccff1625b13341e.PNG?09BG5AazWSvcs2bxUxT4DsUT--o3zS8vnr8ykoPWZROpeXXzuTMgUrSRwGJ9p2EC8eF0CLDup4_0Mdl2xG22_Jfg1Kg0C4pm063nRD8_oM4I7F3F2T4Gs6pQplcWxcrLhfYXb0vYYNLjCmgrlH7L59aNdE-xxtkyxMLxWlbTUMGMfJge" alt="img"></p>
<p><img src="https://img-a.udemycdn.com/redactor/raw/2019-05-30_14-47-14-07b2638d1a72cb2d5b000c00971f6436.PNG?mh54IFQgm-TfJNMQdLqFkBoZcd3ehECrCg3OnqVOPS7N-jAI2FGOWsXe8c4juYCbvazYMZINlhtvGuVnD1g3A5dmh1UXX5kRPYId-c4ltDSGE9bsRM0l8JaVyVMhB76AJZSoJrdaqnJPbVzyQEOM42NqzT5FSjSK6KjSeWkZqwspzw_f" alt="img"></p>
<p>A copy of the file with your changes is saved in a temporary location as shown above.</p>
<p>You can then delete the existing pod by running the command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod webapp</span><br></pre></td></tr></table></figure>



<p>Then create a new pod with your changes using the temporary file</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f &#x2F;tmp&#x2F;kubectl-edit-ccvrq.yaml</span><br></pre></td></tr></table></figure>



<ul>
<li>2.The second option is to extract the pod definition in YAML format to a file using the command</li>
</ul>
<p>ä½¿ç”¨ä»¥yamlæ ¼å¼æå–podçš„å®šä¹‰å¹¶ä¿å­˜åˆ°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod webapp -o yaml &gt; my-new-pod.yaml</span><br></pre></td></tr></table></figure>

<p>Then make the changes to the exported file using an editor (vi editor). Save the changes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi my-new-pod.yaml</span><br></pre></td></tr></table></figure>

<p>Then delete the existing pod</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod webapp</span><br></pre></td></tr></table></figure>

<p>Then create a new pod with the edited file</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f my-new-pod.yaml</span><br></pre></td></tr></table></figure>



<h4 id="Edit-Deployments"><a href="#Edit-Deployments" class="headerlink" title="Edit Deployments"></a>Edit Deployments</h4><p>With Deployments you can easily edit any field/property of the POD template. Since the pod template is a child of the deployment specification,  with every change the deployment will automatically delete and create a new pod with the new changes. So if you are asked to edit a property of a POD part of a deployment you may do that simply by running the command</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit deployment my-deployment</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en,default">
    <link itemprop="mainEntityOfPage" href="https://alstonzero.github.io/2020/11/28/go%20context/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HOU YINGQIAO">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MyNote">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/28/go%20context/" class="post-title-link" itemprop="url">go context</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-11-28 22:27:29 / Modified: 12:55:35" itemprop="dateCreated datePublished" datetime="2020-11-28T22:27:29+10:00">2020-11-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Go-Context"><a href="#Go-Context" class="headerlink" title="Go Context"></a>Go Context</h1><blockquote>
<p>ã€ŠGoè¯­è¨€å®æˆ˜ã€‹è¯»ä¹¦ç¬”è®°ï¼Œæœªå®Œå¾…ç»­ï¼Œæ¬¢è¿æ‰«ç å…³æ³¨å…¬ä¼—å·<code>flysnow_org</code>æˆ–è€…ç½‘ç«™<a target="_blank" rel="noopener" href="http://www.flysnow.org/">http://www.flysnow.org/</a>ï¼Œç¬¬ä¸€æ—¶é—´çœ‹åç»­ç¬”è®°ã€‚è§‰å¾—æœ‰å¸®åŠ©çš„è¯ï¼Œé¡ºæ‰‹åˆ†äº«åˆ°æœ‹å‹åœˆå§ï¼Œæ„Ÿè°¢æ”¯æŒã€‚</p>
</blockquote>
<p>æ§åˆ¶å¹¶å‘æœ‰ä¸¤ç§ç»å…¸çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯WaitGroupï¼Œå¦å¤–ä¸€ç§å°±æ˜¯Contextï¼Œä»Šå¤©æˆ‘å°±è°ˆè°ˆContextã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯WaitGroup"><a href="#ä»€ä¹ˆæ˜¯WaitGroup" class="headerlink" title="ä»€ä¹ˆæ˜¯WaitGroup"></a>ä»€ä¹ˆæ˜¯WaitGroup</h2><p>WaitGroupä»¥å‰æˆ‘ä»¬åœ¨å¹¶å‘çš„æ—¶å€™ä»‹ç»è¿‡ï¼Œå®ƒæ˜¯ä¸€ç§æ§åˆ¶å¹¶å‘çš„æ–¹å¼ï¼Œå®ƒçš„è¿™ç§æ–¹å¼æ˜¯æ§åˆ¶å¤šä¸ªgoroutineåŒæ—¶å®Œæˆã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line">	wg.Add(<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		time.Sleep(<span class="number">2</span>*time.Second)</span><br><span class="line">		fmt.Println(<span class="string">&quot;1å·å®Œæˆ&quot;</span>)</span><br><span class="line">		wg.Done()</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		time.Sleep(<span class="number">2</span>*time.Second)</span><br><span class="line">		fmt.Println(<span class="string">&quot;2å·å®Œæˆ&quot;</span>)</span><br><span class="line">		wg.Done()</span><br><span class="line">	&#125;()</span><br><span class="line">	wg.Wait()</span><br><span class="line">	fmt.Println(<span class="string">&quot;å¥½äº†ï¼Œå¤§å®¶éƒ½å¹²å®Œäº†ï¼Œæ”¾å·¥&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼Œä¸€å®šè¦ä¾‹å­ä¸­çš„2ä¸ªgoroutineåŒæ—¶åšå®Œï¼Œæ‰ç®—æ˜¯å®Œæˆï¼Œå…ˆåšå¥½çš„å°±è¦ç­‰ç€å…¶ä»–æœªå®Œæˆçš„ï¼Œæ‰€æœ‰çš„goroutineè¦éƒ½å…¨éƒ¨å®Œæˆæ‰å¯ä»¥ã€‚</p>
<p>è¿™æ˜¯ä¸€ç§æ§åˆ¶å¹¶å‘çš„æ–¹å¼ï¼Œè¿™ç§å°¤å…¶é€‚ç”¨äºï¼Œå¥½å¤šä¸ªgoroutineååŒåšä¸€ä»¶äº‹æƒ…çš„æ—¶å€™ï¼Œå› ä¸ºæ¯ä¸ªgoroutineåšçš„éƒ½æ˜¯è¿™ä»¶äº‹æƒ…çš„ä¸€éƒ¨åˆ†ï¼Œåªæœ‰å…¨éƒ¨çš„goroutineéƒ½å®Œæˆï¼Œè¿™ä»¶äº‹æƒ…æ‰ç®—æ˜¯å®Œæˆï¼Œè¿™æ˜¯ç­‰å¾…çš„æ–¹å¼ã€‚</p>
<p>åœ¨å®é™…çš„ä¸šåŠ¡ç§ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰è¿™ä¹ˆä¸€ç§åœºæ™¯ï¼šéœ€è¦æˆ‘ä»¬ä¸»åŠ¨çš„é€šçŸ¥æŸä¸€ä¸ªgoroutineç»“æŸã€‚æ¯”å¦‚æˆ‘ä»¬å¼€å¯ä¸€ä¸ªåå°goroutineä¸€ç›´åšäº‹æƒ…ï¼Œæ¯”å¦‚ç›‘æ§ï¼Œç°åœ¨ä¸éœ€è¦äº†ï¼Œå°±éœ€è¦é€šçŸ¥è¿™ä¸ªç›‘æ§goroutineç»“æŸï¼Œä¸ç„¶å®ƒä¼šä¸€ç›´è·‘ï¼Œå°±æ³„æ¼äº†ã€‚</p>
<h2 id="chané€šçŸ¥"><a href="#chané€šçŸ¥" class="headerlink" title="chané€šçŸ¥"></a>chané€šçŸ¥</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ä¸€ä¸ªgoroutineå¯åŠ¨åï¼Œæˆ‘ä»¬æ˜¯æ— æ³•æ§åˆ¶ä»–çš„ï¼Œå¤§éƒ¨åˆ†æƒ…å†µæ˜¯ç­‰å¾…å®ƒè‡ªå·±ç»“æŸï¼Œé‚£ä¹ˆå¦‚æœè¿™ä¸ªgoroutineæ˜¯ä¸€ä¸ªä¸ä¼šè‡ªå·±ç»“æŸçš„åå°goroutineå‘¢ï¼Ÿæ¯”å¦‚ç›‘æ§ç­‰ï¼Œä¼šä¸€ç›´è¿è¡Œçš„ã€‚</p>
<p>è¿™ç§æƒ…å†µåŒ–ï¼Œä¸€ç›´å‚»ç“œå¼çš„åŠæ³•æ˜¯å…¨å±€å˜é‡ï¼Œå…¶ä»–åœ°æ–¹é€šè¿‡ä¿®æ”¹è¿™ä¸ªå˜é‡å®Œæˆç»“æŸé€šçŸ¥ï¼Œç„¶ååå°goroutineä¸åœçš„æ£€æŸ¥è¿™ä¸ªå˜é‡ï¼Œå¦‚æœå‘ç°è¢«é€šçŸ¥å…³é—­äº†ï¼Œå°±è‡ªæˆ‘ç»“æŸã€‚</p>
<p>è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯é¦–å…ˆæˆ‘ä»¬è¦ä¿è¯è¿™ä¸ªå˜é‡åœ¨å¤šçº¿ç¨‹ä¸‹çš„å®‰å…¨ï¼ŒåŸºäºæ­¤ï¼Œæœ‰ä¸€ç§æ›´å¥½çš„æ–¹å¼ï¼š<code>chan + select </code>ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	stop := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">select</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> &lt;-stop:</span><br><span class="line">				fmt.Println(<span class="string">&quot;ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...&quot;</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				fmt.Println(<span class="string">&quot;goroutineç›‘æ§ä¸­...&quot;</span>)</span><br><span class="line">				time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	time.Sleep(<span class="number">10</span> * time.Second)</span><br><span class="line">	fmt.Println(<span class="string">&quot;å¯ä»¥äº†ï¼Œé€šçŸ¥ç›‘æ§åœæ­¢&quot;</span>)</span><br><span class="line">	stop&lt;- <span class="literal">true</span></span><br><span class="line">	<span class="comment">//ä¸ºäº†æ£€æµ‹ç›‘æ§è¿‡æ˜¯å¦åœæ­¢ï¼Œå¦‚æœæ²¡æœ‰ç›‘æ§è¾“å‡ºï¼Œå°±è¡¨ç¤ºåœæ­¢äº†</span></span><br><span class="line">	time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¾‹å­ä¸­æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>stop</code>çš„chanï¼Œé€šçŸ¥ä»–ç»“æŸåå°goroutineã€‚å®ç°ä¹Ÿéå¸¸ç®€å•ï¼Œåœ¨åå°goroutineä¸­ï¼Œä½¿ç”¨selectåˆ¤æ–­<code>stop</code>æ˜¯å¦å¯ä»¥æ¥æ”¶åˆ°å€¼ï¼Œå¦‚æœå¯ä»¥æ¥æ”¶åˆ°ï¼Œå°±è¡¨ç¤ºå¯ä»¥é€€å‡ºåœæ­¢äº†ï¼›å¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°ï¼Œå°±ä¼šæ‰§è¡Œ<code>default</code>é‡Œçš„ç›‘æ§é€»è¾‘ï¼Œç»§ç»­ç›‘æ§ï¼Œåªåˆ°æ”¶åˆ°<code>stop</code>çš„é€šçŸ¥ã€‚</p>
<p>æœ‰äº†ä»¥ä¸Šçš„é€»è¾‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å…¶ä»–goroutineç§ï¼Œç»™<code>stop</code> chanå‘é€å€¼äº†ï¼Œä¾‹å­ä¸­æ˜¯åœ¨main goroutineä¸­å‘é€çš„ï¼Œæ§åˆ¶è®©è¿™ä¸ªç›‘æ§çš„goroutineç»“æŸã€‚</p>
<p>å‘é€äº†<code>stop&lt;- true</code>ç»“æŸçš„æŒ‡ä»¤åï¼Œæˆ‘è¿™é‡Œä½¿ç”¨<code>time.Sleep(5 * time.Second)</code>æ•…æ„åœé¡¿5ç§’æ¥æ£€æµ‹æˆ‘ä»¬ç»“æŸç›‘æ§goroutineæ˜¯å¦æˆåŠŸã€‚å¦‚æœæˆåŠŸçš„è¯ï¼Œä¸ä¼šå†æœ‰<code>goroutineç›‘æ§ä¸­...</code>çš„è¾“å‡ºäº†ï¼›å¦‚æœæ²¡æœ‰æˆåŠŸï¼Œç›‘æ§goroutineå°±ä¼šç»§ç»­æ‰“å°<code>goroutineç›‘æ§ä¸­...</code>è¾“å‡ºã€‚</p>
<p>è¿™ç§chan+selectçš„æ–¹å¼ï¼Œæ˜¯æ¯”è¾ƒä¼˜é›…çš„ç»“æŸä¸€ä¸ªgoroutineçš„æ–¹å¼ï¼Œä¸è¿‡è¿™ç§æ–¹å¼ä¹Ÿæœ‰å±€é™æ€§ï¼Œå¦‚æœæœ‰å¾ˆå¤šgoroutineéƒ½éœ€è¦æ§åˆ¶ç»“æŸæ€ä¹ˆåŠå‘¢ï¼Ÿå¦‚æœè¿™äº›goroutineåˆè¡ç”Ÿäº†å…¶ä»–æ›´å¤šçš„goroutineæ€ä¹ˆåŠå‘¢ï¼Ÿå¦‚æœä¸€å±‚å±‚çš„æ— ç©·å°½çš„goroutineå‘¢ï¼Ÿè¿™å°±éå¸¸å¤æ‚äº†ï¼Œå³ä½¿æˆ‘ä»¬å®šä¹‰å¾ˆå¤šchanä¹Ÿå¾ˆéš¾è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºgoroutineçš„å…³ç³»é“¾å°±å¯¼è‡´äº†è¿™ç§åœºæ™¯éå¸¸å¤æ‚ã€‚</p>
<h2 id="åˆè¯†Context"><a href="#åˆè¯†Context" class="headerlink" title="åˆè¯†Context"></a>åˆè¯†Context</h2><p>ä¸Šé¢è¯´çš„è¿™ç§åœºæ™¯æ˜¯å­˜åœ¨çš„ï¼Œæ¯”å¦‚ä¸€ä¸ªç½‘ç»œè¯·æ±‚Requestï¼Œæ¯ä¸ªRequestéƒ½éœ€è¦å¼€å¯ä¸€ä¸ªgoroutineåšä¸€äº›äº‹æƒ…ï¼Œè¿™äº›goroutineåˆå¯èƒ½ä¼šå¼€å¯å…¶ä»–çš„goroutineã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§å¯ä»¥è·Ÿè¸ªgoroutineçš„æ–¹æ¡ˆï¼Œæ‰å¯ä»¥è¾¾åˆ°æ§åˆ¶ä»–ä»¬çš„ç›®çš„ï¼Œè¿™å°±æ˜¯Goè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›çš„Contextï¼Œç§°ä¹‹ä¸ºä¸Šä¸‹æ–‡éå¸¸è´´åˆ‡ï¼Œå®ƒå°±æ˜¯goroutineçš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å°±ä½¿ç”¨Go Contexté‡å†™ä¸Šé¢çš„ç¤ºä¾‹ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">select</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">				fmt.Println(<span class="string">&quot;ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...&quot;</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				fmt.Println(<span class="string">&quot;goroutineç›‘æ§ä¸­...&quot;</span>)</span><br><span class="line">				time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;(ctx)</span><br><span class="line"></span><br><span class="line">	time.Sleep(<span class="number">10</span> * time.Second)</span><br><span class="line">	fmt.Println(<span class="string">&quot;å¯ä»¥äº†ï¼Œé€šçŸ¥ç›‘æ§åœæ­¢&quot;</span>)</span><br><span class="line">	cancel()</span><br><span class="line">	<span class="comment">//ä¸ºäº†æ£€æµ‹ç›‘æ§è¿‡æ˜¯å¦åœæ­¢ï¼Œå¦‚æœæ²¡æœ‰ç›‘æ§è¾“å‡ºï¼Œå°±è¡¨ç¤ºåœæ­¢äº†</span></span><br><span class="line">	time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡å†™æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æŠŠåŸæ¥çš„chan <code>stop</code> æ¢æˆContextï¼Œä½¿ç”¨Contextè·Ÿè¸ªgoroutineï¼Œä»¥ä¾¿è¿›è¡Œæ§åˆ¶ï¼Œæ¯”å¦‚ç»“æŸç­‰ã€‚</p>
<p><code>context.Background()</code> è¿”å›ä¸€ä¸ªç©ºçš„Contextï¼Œè¿™ä¸ªç©ºçš„Contextä¸€èˆ¬ç”¨äºæ•´ä¸ªContextæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨<code>context.WithCancel(parent)</code>å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªå¯å–æ¶ˆçš„å­Contextï¼Œç„¶åå½“ä½œå‚æ•°ä¼ ç»™goroutineä½¿ç”¨ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå­Contextè·Ÿè¸ªè¿™ä¸ªgoroutineã€‚</p>
<p>åœ¨goroutineä¸­ï¼Œä½¿ç”¨selectè°ƒç”¨<code>&lt;-ctx.Done()</code>åˆ¤æ–­æ˜¯å¦è¦ç»“æŸï¼Œå¦‚æœæ¥å—åˆ°å€¼çš„è¯ï¼Œå°±å¯ä»¥è¿”å›ç»“æŸgoroutineäº†ï¼›å¦‚æœæ¥æ”¶ä¸åˆ°ï¼Œå°±ä¼šç»§ç»­è¿›è¡Œç›‘æ§ã€‚</p>
<p>é‚£ä¹ˆæ˜¯å¦‚ä½•å‘é€ç»“æŸæŒ‡ä»¤çš„å‘¢ï¼Ÿè¿™å°±æ˜¯ç¤ºä¾‹ä¸­çš„<code>cancel</code>å‡½æ•°å•¦ï¼Œå®ƒæ˜¯æˆ‘ä»¬è°ƒç”¨<code>context.WithCancel(parent)</code>å‡½æ•°ç”Ÿæˆå­Contextçš„æ—¶å€™è¿”å›çš„ï¼Œç¬¬äºŒä¸ªè¿”å›å€¼å°±æ˜¯è¿™ä¸ªå–æ¶ˆå‡½æ•°ï¼Œå®ƒæ˜¯<code>CancelFunc</code>ç±»å‹çš„ã€‚æˆ‘ä»¬è°ƒç”¨å®ƒå°±å¯ä»¥å‘å‡ºå–æ¶ˆæŒ‡ä»¤ï¼Œç„¶åæˆ‘ä»¬çš„ç›‘æ§goroutineå°±ä¼šæ”¶åˆ°ä¿¡å·ï¼Œå°±ä¼šè¿”å›ç»“æŸã€‚</p>
<h2 id="Contextæ§åˆ¶å¤šä¸ªgoroutine"><a href="#Contextæ§åˆ¶å¤šä¸ªgoroutine" class="headerlink" title="Contextæ§åˆ¶å¤šä¸ªgoroutine"></a>Contextæ§åˆ¶å¤šä¸ªgoroutine</h2><p>ä½¿ç”¨Contextæ§åˆ¶ä¸€ä¸ªgoroutineçš„ä¾‹å­å¦‚ä¸Šï¼Œéå¸¸ç®€å•ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹æ§åˆ¶å¤šä¸ªgoroutineçš„ä¾‹å­ï¼Œå…¶å®ä¹Ÿæ¯”è¾ƒç®€å•ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">	<span class="keyword">go</span> watch(ctx,<span class="string">&quot;ã€ç›‘æ§1ã€‘&quot;</span>)</span><br><span class="line">	<span class="keyword">go</span> watch(ctx,<span class="string">&quot;ã€ç›‘æ§2ã€‘&quot;</span>)</span><br><span class="line">	<span class="keyword">go</span> watch(ctx,<span class="string">&quot;ã€ç›‘æ§3ã€‘&quot;</span>)</span><br><span class="line"></span><br><span class="line">	time.Sleep(<span class="number">10</span> * time.Second)</span><br><span class="line">	fmt.Println(<span class="string">&quot;å¯ä»¥äº†ï¼Œé€šçŸ¥ç›‘æ§åœæ­¢&quot;</span>)</span><br><span class="line">	cancel()</span><br><span class="line">	<span class="comment">//ä¸ºäº†æ£€æµ‹ç›‘æ§è¿‡æ˜¯å¦åœæ­¢ï¼Œå¦‚æœæ²¡æœ‰ç›‘æ§è¾“å‡ºï¼Œå°±è¡¨ç¤ºåœæ­¢äº†</span></span><br><span class="line">	time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">watch</span><span class="params">(ctx context.Context, name <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">			fmt.Println(name,<span class="string">&quot;ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			fmt.Println(name,<span class="string">&quot;goroutineç›‘æ§ä¸­...&quot;</span>)</span><br><span class="line">			time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ç¤ºä¾‹ä¸­å¯åŠ¨äº†3ä¸ªç›‘æ§goroutineè¿›è¡Œä¸æ–­çš„ç›‘æ§ï¼Œæ¯ä¸€ä¸ªéƒ½ä½¿ç”¨äº†Contextè¿›è¡Œè·Ÿè¸ªï¼Œå½“æˆ‘ä»¬ä½¿ç”¨<code>cancel</code>å‡½æ•°é€šçŸ¥å–æ¶ˆæ—¶ï¼Œè¿™3ä¸ªgoroutineéƒ½ä¼šè¢«ç»“æŸã€‚è¿™å°±æ˜¯Contextçš„æ§åˆ¶èƒ½åŠ›ï¼Œå®ƒå°±åƒä¸€ä¸ªæ§åˆ¶å™¨ä¸€æ ·ï¼ŒæŒ‰ä¸‹å¼€å…³åï¼Œæ‰€æœ‰åŸºäºè¿™ä¸ªContextæˆ–è€…è¡ç”Ÿçš„å­Contextéƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œè¿™æ—¶å°±å¯ä»¥è¿›è¡Œæ¸…ç†æ“ä½œäº†ï¼Œæœ€ç»ˆé‡Šæ”¾goroutineï¼Œè¿™å°±ä¼˜é›…çš„è§£å†³äº†goroutineå¯åŠ¨åä¸å¯æ§çš„é—®é¢˜ã€‚</p>
<h2 id="Contextæ¥å£"><a href="#Contextæ¥å£" class="headerlink" title="Contextæ¥å£"></a>Contextæ¥å£</h2><p>Contextçš„æ¥å£å®šä¹‰çš„æ¯”è¾ƒç®€æ´ï¼Œæˆ‘ä»¬çœ‹ä¸‹è¿™ä¸ªæ¥å£çš„æ–¹æ³•ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Context <span class="keyword">interface</span> &#123;</span><br><span class="line">	Deadline() (deadline time.Time, ok <span class="keyword">bool</span>)</span><br><span class="line"></span><br><span class="line">	Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	Err() error</span><br><span class="line"></span><br><span class="line">	Value(key <span class="keyword">interface</span>&#123;&#125;) <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ¥å£å…±æœ‰4ä¸ªæ–¹æ³•ï¼Œäº†è§£è¿™äº›æ–¹æ³•çš„æ„æ€éå¸¸é‡è¦ï¼Œè¿™æ ·æˆ‘ä»¬æ‰å¯ä»¥æ›´å¥½çš„ä½¿ç”¨ä»–ä»¬ã€‚</p>
<p><code>Deadline</code>æ–¹æ³•æ˜¯è·å–è®¾ç½®çš„æˆªæ­¢æ—¶é—´çš„æ„æ€ï¼Œç¬¬ä¸€ä¸ªè¿”å›å¼æ˜¯æˆªæ­¢æ—¶é—´ï¼Œåˆ°äº†è¿™ä¸ªæ—¶é—´ç‚¹ï¼ŒContextä¼šè‡ªåŠ¨å‘èµ·å–æ¶ˆè¯·æ±‚ï¼›ç¬¬äºŒä¸ªè¿”å›å€¼ok==falseæ—¶è¡¨ç¤ºæ²¡æœ‰è®¾ç½®æˆªæ­¢æ—¶é—´ï¼Œå¦‚æœéœ€è¦å–æ¶ˆçš„è¯ï¼Œéœ€è¦è°ƒç”¨å–æ¶ˆå‡½æ•°è¿›è¡Œå–æ¶ˆã€‚</p>
<p><code>Done</code>æ–¹æ³•è¿”å›ä¸€ä¸ªåªè¯»çš„chanï¼Œç±»å‹ä¸º<code>struct&#123;&#125;</code>ï¼Œæˆ‘ä»¬åœ¨goroutineä¸­ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›çš„chanå¯ä»¥è¯»å–ï¼Œåˆ™æ„å‘³ç€parent contextå·²ç»å‘èµ·äº†å–æ¶ˆè¯·æ±‚ï¼Œæˆ‘ä»¬é€šè¿‡<code>Done</code>æ–¹æ³•æ”¶åˆ°è¿™ä¸ªä¿¡å·åï¼Œå°±åº”è¯¥åšæ¸…ç†æ“ä½œï¼Œç„¶åé€€å‡ºgoroutineï¼Œé‡Šæ”¾èµ„æºã€‚</p>
<p><code>Err</code>æ–¹æ³•è¿”å›å–æ¶ˆçš„é”™è¯¯åŸå› ï¼Œå› ä¸ºä»€ä¹ˆContextè¢«å–æ¶ˆã€‚</p>
<p><code>Value</code>æ–¹æ³•è·å–è¯¥Contextä¸Šç»‘å®šçš„å€¼ï¼Œæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ‰€ä»¥è¦é€šè¿‡ä¸€ä¸ªKeyæ‰å¯ä»¥è·å–å¯¹åº”çš„å€¼ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>ä»¥ä¸Šå››ä¸ªæ–¹æ³•ä¸­å¸¸ç”¨çš„å°±æ˜¯<code>Done</code>äº†ï¼Œå¦‚æœContextå–æ¶ˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå…³é—­çš„chanï¼Œå…³é—­çš„chanæ˜¯å¯ä»¥è¯»å–çš„ï¼Œæ‰€ä»¥åªè¦å¯ä»¥è¯»å–çš„æ—¶å€™ï¼Œå°±æ„å‘³ç€æ”¶åˆ°Contextå–æ¶ˆçš„ä¿¡å·äº†ï¼Œä»¥ä¸‹æ˜¯è¿™ä¸ªæ–¹æ³•çš„ç»å…¸ç”¨æ³•ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Stream</span><span class="params">(ctx context.Context, out <span class="keyword">chan</span>&lt;- Value)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		v, err := DoSomething(ctx)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> err</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">			<span class="keyword">return</span> ctx.Err()</span><br><span class="line">		<span class="keyword">case</span> out &lt;- v:</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Contextæ¥å£å¹¶ä¸éœ€è¦æˆ‘ä»¬å®ç°ï¼ŒGoå†…ç½®å·²ç»å¸®æˆ‘ä»¬å®ç°äº†2ä¸ªï¼Œæˆ‘ä»¬ä»£ç ä¸­æœ€å¼€å§‹éƒ½æ˜¯ä»¥è¿™ä¸¤ä¸ªå†…ç½®çš„ä½œä¸ºæœ€é¡¶å±‚çš„partent contextï¼Œè¡ç”Ÿå‡ºæ›´å¤šçš„å­Contextã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	background = <span class="built_in">new</span>(emptyCtx)</span><br><span class="line">	todo       = <span class="built_in">new</span>(emptyCtx)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Background</span><span class="params">()</span> <span class="title">Context</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> background</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TODO</span><span class="params">()</span> <span class="title">Context</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> todo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ä¸€ä¸ªæ˜¯<code>Background</code>ï¼Œä¸»è¦ç”¨äºmainå‡½æ•°ã€åˆå§‹åŒ–ä»¥åŠæµ‹è¯•ä»£ç ä¸­ï¼Œä½œä¸ºContextè¿™ä¸ªæ ‘ç»“æ„çš„æœ€é¡¶å±‚çš„Contextï¼Œä¹Ÿå°±æ˜¯æ ¹Contextã€‚</p>
<p>ä¸€ä¸ªæ˜¯<code>TODO</code>,å®ƒç›®å‰è¿˜ä¸çŸ¥é“å…·ä½“çš„ä½¿ç”¨åœºæ™¯ï¼Œå¦‚æœæˆ‘ä»¬ä¸çŸ¥é“è¯¥ä½¿ç”¨ä»€ä¹ˆContextçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚</p>
<p>ä»–ä»¬ä¸¤ä¸ªæœ¬è´¨ä¸Šéƒ½æ˜¯<code>emptyCtx</code>ç»“æ„ä½“ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªä¸å¯å–æ¶ˆï¼Œæ²¡æœ‰è®¾ç½®æˆªæ­¢æ—¶é—´ï¼Œæ²¡æœ‰æºå¸¦ä»»ä½•å€¼çš„Contextã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> emptyCtx <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Deadline</span><span class="params">()</span> <span class="params">(deadline time.Time, ok <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Done</span><span class="params">()</span> &lt;-<span class="title">chan</span> <span class="title">struct</span></span>&#123;&#125; &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Err</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>è¿™å°±æ˜¯<code>emptyCtx</code>å®ç°Contextæ¥å£çš„æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›æ–¹æ³•ä»€ä¹ˆéƒ½æ²¡åšï¼Œè¿”å›çš„éƒ½æ˜¯nilæˆ–è€…é›¶å€¼ã€‚</p>
<h2 id="Contextçš„ç»§æ‰¿è¡ç”Ÿ"><a href="#Contextçš„ç»§æ‰¿è¡ç”Ÿ" class="headerlink" title="Contextçš„ç»§æ‰¿è¡ç”Ÿ"></a>Contextçš„ç»§æ‰¿è¡ç”Ÿ</h2><p>æœ‰äº†å¦‚ä¸Šçš„æ ¹Contextï¼Œé‚£ä¹ˆæ˜¯å¦‚ä½•è¡ç”Ÿæ›´å¤šçš„å­Contextçš„å‘¢ï¼Ÿè¿™å°±è¦é contextåŒ…ä¸ºæˆ‘ä»¬æä¾›çš„<code>With</code>ç³»åˆ—çš„å‡½æ•°äº†ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCancel</span><span class="params">(parent Context)</span> <span class="params">(ctx Context, cancel CancelFunc)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithDeadline</span><span class="params">(parent Context, deadline time.Time)</span> <span class="params">(Context, CancelFunc)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(parent Context, timeout time.Duration)</span> <span class="params">(Context, CancelFunc)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithValue</span><span class="params">(parent Context, key, val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Context</span></span></span><br></pre></td></tr></table></figure>

<p>è¿™å››ä¸ª<code>With</code>å‡½æ•°ï¼Œæ¥æ”¶çš„éƒ½æœ‰ä¸€ä¸ªpartentå‚æ•°ï¼Œå°±æ˜¯çˆ¶Contextï¼Œæˆ‘ä»¬è¦åŸºäºè¿™ä¸ªçˆ¶Contextåˆ›å»ºå‡ºå­Contextçš„æ„æ€ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ç†è§£ä¸ºå­Contextå¯¹çˆ¶Contextçš„ç»§æ‰¿ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºåŸºäºçˆ¶Contextçš„è¡ç”Ÿã€‚</p>
<p>é€šè¿‡è¿™äº›å‡½æ•°ï¼Œå°±åˆ›å»ºäº†ä¸€é¢—Contextæ ‘ï¼Œæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æœ‰ä»»æ„å¤šä¸ªå­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å±‚çº§å¯ä»¥æœ‰ä»»æ„å¤šä¸ªã€‚</p>
<p><code>WithCancel</code>å‡½æ•°ï¼Œä¼ é€’ä¸€ä¸ªçˆ¶Contextä½œä¸ºå‚æ•°ï¼Œè¿”å›å­Contextï¼Œä»¥åŠä¸€ä¸ªå–æ¶ˆå‡½æ•°ç”¨æ¥å–æ¶ˆContextã€‚ <code>WithDeadline</code>å‡½æ•°ï¼Œå’Œ<code>WithCancel</code>å·®ä¸å¤šï¼Œå®ƒä¼šå¤šä¼ é€’ä¸€ä¸ªæˆªæ­¢æ—¶é—´å‚æ•°ï¼Œæ„å‘³ç€åˆ°äº†è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œä¼šè‡ªåŠ¨å–æ¶ˆContextï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ç­‰åˆ°è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥æå‰é€šè¿‡å–æ¶ˆå‡½æ•°è¿›è¡Œå–æ¶ˆã€‚</p>
<p><code>WithTimeout</code>å’Œ<code>WithDeadline</code>åŸºæœ¬ä¸Šä¸€æ ·ï¼Œè¿™ä¸ªè¡¨ç¤ºæ˜¯è¶…æ—¶è‡ªåŠ¨å–æ¶ˆï¼Œæ˜¯å¤šå°‘æ—¶é—´åè‡ªåŠ¨å–æ¶ˆContextçš„æ„æ€ã€‚</p>
<p><code>WithValue</code>å‡½æ•°å’Œå–æ¶ˆContextæ— å…³ï¼Œå®ƒæ˜¯ä¸ºäº†ç”Ÿæˆä¸€ä¸ªç»‘å®šäº†ä¸€ä¸ªé”®å€¼å¯¹æ•°æ®çš„Contextï¼Œè¿™ä¸ªç»‘å®šçš„æ•°æ®å¯ä»¥é€šè¿‡<code>Context.Value</code>æ–¹æ³•è®¿é—®åˆ°ï¼Œåé¢æˆ‘ä»¬ä¼šä¸“é—¨è®²ã€‚</p>
<p>å¤§å®¶å¯èƒ½ç•™æ„åˆ°ï¼Œå‰ä¸‰ä¸ªå‡½æ•°éƒ½è¿”å›ä¸€ä¸ªå–æ¶ˆå‡½æ•°<code>CancelFunc</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œå®ƒçš„å®šä¹‰éå¸¸ç®€å•ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CancelFunc <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>



<p>è¿™å°±æ˜¯å–æ¶ˆå‡½æ•°çš„ç±»å‹ï¼Œè¯¥å‡½æ•°å¯ä»¥å–æ¶ˆä¸€ä¸ªContextï¼Œä»¥åŠè¿™ä¸ªèŠ‚ç‚¹Contextä¸‹æ‰€æœ‰çš„æ‰€æœ‰çš„Contextï¼Œä¸ç®¡æœ‰å¤šå°‘å±‚çº§ã€‚</p>
<h2 id="WithValueä¼ é€’å…ƒæ•°æ®"><a href="#WithValueä¼ é€’å…ƒæ•°æ®" class="headerlink" title="WithValueä¼ é€’å…ƒæ•°æ®"></a>WithValueä¼ é€’å…ƒæ•°æ®</h2><p>é€šè¿‡Contextæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ é€’ä¸€äº›å¿…é¡»çš„å…ƒæ•°æ®ï¼Œè¿™äº›æ•°æ®ä¼šé™„åŠ åœ¨Contextä¸Šä»¥ä¾›ä½¿ç”¨ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> key <span class="keyword">string</span>=<span class="string">&quot;name&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ctx, cancel := context.WithCancel(context.Background())</span><br><span class="line">	<span class="comment">//é™„åŠ å€¼</span></span><br><span class="line">	valueCtx:=context.WithValue(ctx,key,<span class="string">&quot;ã€ç›‘æ§1ã€‘&quot;</span>)</span><br><span class="line">	<span class="keyword">go</span> watch(valueCtx)</span><br><span class="line">	time.Sleep(<span class="number">10</span> * time.Second)</span><br><span class="line">	fmt.Println(<span class="string">&quot;å¯ä»¥äº†ï¼Œé€šçŸ¥ç›‘æ§åœæ­¢&quot;</span>)</span><br><span class="line">	cancel()</span><br><span class="line">	<span class="comment">//ä¸ºäº†æ£€æµ‹ç›‘æ§è¿‡æ˜¯å¦åœæ­¢ï¼Œå¦‚æœæ²¡æœ‰ç›‘æ§è¾“å‡ºï¼Œå°±è¡¨ç¤ºåœæ­¢äº†</span></span><br><span class="line">	time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">watch</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">			<span class="comment">//å–å‡ºå€¼</span></span><br><span class="line">			fmt.Println(ctx.Value(key),<span class="string">&quot;ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="comment">//å–å‡ºå€¼</span></span><br><span class="line">			fmt.Println(ctx.Value(key),<span class="string">&quot;goroutineç›‘æ§ä¸­...&quot;</span>)</span><br><span class="line">			time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>åœ¨å‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬é€šè¿‡ä¼ é€’å‚æ•°çš„æ–¹å¼ï¼ŒæŠŠ<code>name</code>çš„å€¼ä¼ é€’ç»™ç›‘æ§å‡½æ•°ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬å®ç°ä¸€æ ·çš„æ•ˆæœï¼Œä½†æ˜¯é€šè¿‡çš„æ˜¯Contextçš„Valueçš„æ–¹å¼ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>context.WithValue</code>æ–¹æ³•é™„åŠ ä¸€å¯¹K-Vçš„é”®å€¼å¯¹ï¼Œè¿™é‡ŒKeyå¿…é¡»æ˜¯ç­‰ä»·æ€§çš„ï¼Œä¹Ÿå°±æ˜¯å…·æœ‰å¯æ¯”æ€§ï¼›Valueå€¼è¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„Contextï¼Œè¿™ä¸ªæ–°çš„Contextå¸¦æœ‰è¿™ä¸ªé”®å€¼å¯¹ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡<code>Value</code>æ–¹æ³•è¯»å–<code>ctx.Value(key)</code>ã€‚</p>
<p>è®°ä½ï¼Œä½¿ç”¨WithValueä¼ å€¼ï¼Œä¸€èˆ¬æ˜¯å¿…é¡»çš„å€¼ï¼Œä¸è¦ä»€ä¹ˆå€¼éƒ½ä¼ é€’ã€‚</p>
<h2 id="Context-ä½¿ç”¨åŸåˆ™"><a href="#Context-ä½¿ç”¨åŸåˆ™" class="headerlink" title="Context ä½¿ç”¨åŸåˆ™"></a>Context ä½¿ç”¨åŸåˆ™</h2><ol>
<li>ä¸è¦æŠŠContextæ”¾åœ¨ç»“æ„ä½“ä¸­ï¼Œè¦ä»¥å‚æ•°çš„æ–¹å¼ä¼ é€’</li>
<li>ä»¥Contextä½œä¸ºå‚æ•°çš„å‡½æ•°æ–¹æ³•ï¼Œåº”è¯¥æŠŠContextä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ”¾åœ¨ç¬¬ä¸€ä½ã€‚</li>
<li>ç»™ä¸€ä¸ªå‡½æ•°æ–¹æ³•ä¼ é€’Contextçš„æ—¶å€™ï¼Œä¸è¦ä¼ é€’nilï¼Œå¦‚æœä¸çŸ¥é“ä¼ é€’ä»€ä¹ˆï¼Œå°±ä½¿ç”¨context.TODO</li>
<li>Contextçš„Valueç›¸å…³æ–¹æ³•åº”è¯¥ä¼ é€’å¿…é¡»çš„æ•°æ®ï¼Œä¸è¦ä»€ä¹ˆæ•°æ®éƒ½ä½¿ç”¨è¿™ä¸ªä¼ é€’</li>
<li>Contextæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥æ”¾å¿ƒçš„åœ¨å¤šä¸ªgoroutineä¸­ä¼ é€’</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en,default">
    <link itemprop="mainEntityOfPage" href="https://alstonzero.github.io/2020/11/25/k8s-ETCD%20-%20Commands%20(Optional)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HOU YINGQIAO">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MyNote">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/25/k8s-ETCD%20-%20Commands%20(Optional)/" class="post-title-link" itemprop="url">k8s-ETCD - Commands</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-25 22:27:29" itemprop="dateCreated datePublished" datetime="2020-11-25T22:27:29+10:00">2020-11-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 20:37:15" itemprop="dateModified" datetime="2020-12-31T20:37:15+10:00">2020-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/k8s-udemy/" itemprop="url" rel="index"><span itemprop="name">k8s_udemy</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ETCD-Commands-Optional"><a href="#ETCD-Commands-Optional" class="headerlink" title="ETCD - Commands (Optional)"></a>ETCD - Commands (Optional)</h2><p>(Optional) Additional information about ETCDCTL Utility</p>
<p>ETCDCTL is the CLI tool used to interact withï¼ˆä¸â€¦ç›¸äº’ä½œç”¨ï¼‰ ETCD.</p>
<p>ETCDCTL can interact with ETCD Server using 2 API versions - Version 2 and Version 3.  By default its set to use Version 2. Each version has different sets of commands.</p>
<ul>
<li><p>For example ETCDCTL version 2 supports the following commands:(ETCDCTL ç‰ˆæœ¬2æ”¯æŒä¸€ä¸‹çš„å‘½ä»¤)</p>
<p><code>etcdctl backup</code></p>
<p><code>etcdctl cluster-health</code></p>
<p><code>etcdctl mk</code></p>
<p><code>etcdctl mkdir</code></p>
<p>``etcdctl set`</p>
</li>
</ul>
<ul>
<li><p>Whereasï¼ˆå°½ç®¡ï¼‰ the commands are different in version 3ï¼ˆç‰ˆæœ¬3ä¸­çš„å‘½ä»¤æœ‰æ‰€ä¸åŒï¼‰</p>
<p><code>etcdctl snapshot save</code></p>
<p><code>etcdctl endpoint health</code></p>
<p><code>etcdctl get</code></p>
<p><code>etcdctl put</code></p>
</li>
</ul>
<ul>
<li>To set the right version of API set the environment variable ETCDCTL_API commandï¼ˆè¦è®¾ç½®æ­£ç¡®çš„APIversionï¼Œè¯·è®¾ç½®ç¯å¢ƒå˜é‡ETCDCTL_APIï¼‰<code>export ETCDCTL_API=3</code></li>
</ul>
<ul>
<li><p>When API version is not set, it is assumed to be set to version 2. And version 3 commands listed above donâ€™t work. When API version is set to version 3, version 2 commands listed above donâ€™t work.ï¼ˆå¦‚æœæœªè®¾ç½®APIç‰ˆæœ¬ï¼Œåˆ™å‡å®šå®ƒè®¾ç½®ä¸ºç‰ˆæœ¬2ã€‚ä¸Šé¢åˆ—å‡ºçš„ç‰ˆæœ¬3å‘½ä»¤ä¸èµ·ä½œç”¨ã€‚å½“APIç‰ˆæœ¬è®¾ç½®ä¸ºç‰ˆæœ¬3æ—¶ï¼Œä¸Šé¢åˆ—å‡ºçš„ç‰ˆæœ¬2å‘½ä»¤ä¸èµ·ä½œç”¨ã€‚ï¼‰</p>
</li>
<li><p>Apart from that, you must also specify path to certificate files so that ETCDCTL can authenticate to the ETCD API Server. The certificate files are available in the etcd-master at the following path. We discuss more about certificates in the security section of this course. So donâ€™t worry if this looks complex:ï¼ˆé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¿…é¡»æŒ‡å®šè¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ï¼Œä»¥ä¾¿ETCDCTLå¯ä»¥å‘ETCD APIæœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¯ä¹¦æ–‡ä»¶ä½äºetcd-masterä¸­çš„ä»¥ä¸‹è·¯å¾„ä¸­ã€‚æˆ‘ä»¬å°†åœ¨æœ¬è¯¾ç¨‹çš„å®‰å…¨æ€§éƒ¨åˆ†è®¨è®ºæœ‰å…³è¯ä¹¦çš„æ›´å¤šä¿¡æ¯ã€‚å› æ­¤ï¼Œä¸è¦æ‹…å¿ƒè¿™çœ‹èµ·æ¥æ˜¯å¦å¤æ‚ï¼šï¼‰</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--cacert &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;ca.crt     </span><br><span class="line">--cert &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;server.crt     </span><br><span class="line">--key &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;server.key</span><br></pre></td></tr></table></figure>



<p>So for the commands I showed in the previous video to work you must specify the ETCDCTL API version and path to certificate files. Below is the final form:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec etcd-master -n kube-system -- sh -c &quot;ETCDCTL_API&#x3D;3 etcdctl get &#x2F; --prefix --keys-only --limit&#x3D;10 --cacert &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;ca.crt --cert &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;server.crt  --key &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;etcd&#x2F;server.key&quot; </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en,default">
    <link itemprop="mainEntityOfPage" href="https://alstonzero.github.io/2020/11/25/k8s-Imperative%20vs%20Declarative/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HOU YINGQIAO">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MyNote">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/25/k8s-Imperative%20vs%20Declarative/" class="post-title-link" itemprop="url">k8s-Imperative vs Declarative</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-25 22:27:29" itemprop="dateCreated datePublished" datetime="2020-11-25T22:27:29+10:00">2020-11-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 20:36:30" itemprop="dateModified" datetime="2020-12-31T20:36:30+10:00">2020-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/k8s-udemy/" itemprop="url" rel="index"><span itemprop="name">k8s_udemy</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Imperative-vs-Declarative"><a href="#Imperative-vs-Declarative" class="headerlink" title="Imperative vs Declarative"></a>Imperative vs Declarative</h1><h3 id="Certification-Tips-Imperative-Commands-with-Kubectl"><a href="#Certification-Tips-Imperative-Commands-with-Kubectl" class="headerlink" title="Certification Tips - Imperative Commands with Kubectl"></a>Certification Tips - Imperative Commands with Kubectl</h3><p>While you would be working mostly the declarativeï¼ˆå£°æ˜å¼ï¼‰ way - using definition files, imperativeï¼ˆå‘½ä»¤å¼ï¼‰ commands can help in getting one time tasks done quickly, as well as generate a definition template easily. This would help save a considerable amount of time during your exams.</p>
<p>Before we begin, familiarize with the two options that can come in handy while working with the below commands:</p>
<p><code>--dry-run</code>: By default as soon as the command is run, the resource will be created. If you simply want to test your command, use the <code>--dry-run=client</code> option. This will not create the resource, instead, tell you whether the resource can be created and if your command is right.(<code>--dry-run</code>:é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘½ä»¤è¿è¡Œåå°†ç«‹å³åˆ›å»ºèµ„æºã€‚å¦‚æœåªæƒ³æµ‹è¯•å‘½ä»¤ï¼Œè¯·ä½¿ç”¨è¯¥<code>--dry-run=client</code>é€‰é¡¹ï¼Œè¯¥é€‰é¡¹ä¸ä¼šåˆ›å»ºèµ„æºï¼Œè€Œæ˜¯å‘Šè¯‰æ‚¨æ˜¯å¦å¯ä»¥åˆ›å»ºèµ„æºä»¥åŠæ‚¨çš„å‘½ä»¤æ˜¯å¦æ­£ç¡®ã€‚)</p>
<p><code>-o yaml</code>: This will output the resource definition in YAML format on the screen.</p>
<p>(åœ¨å±å¹•ä¸Šä»¥YAMLæ ¼å¼è¾“å‡ºèµ„æºå®šä¹‰)</p>
<p>Use the above two in combination to generate a resource definition file quickly, that you can then modify and create resources as required, instead of creating the files from scratch.(ç»“åˆä½¿ç”¨ä»¥ä¸Šä¸¤ç§æ–¹æ³•å¯ä»¥å¿«é€Ÿç”Ÿæˆèµ„æºå®šä¹‰æ–‡ä»¶ï¼Œç„¶åå¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹å’Œåˆ›å»ºèµ„æºï¼Œè€Œä¸å¿…ä»å¤´å¼€å§‹åˆ›å»ºæ–‡ä»¶ã€‚)</p>
<h4 id="POD"><a href="#POD" class="headerlink" title="POD"></a>POD</h4><p><strong>Create an NGINX Pod</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run nginx --image&#x3D;nginx</span><br></pre></td></tr></table></figure>



<p><strong>Generate POD Manifest YAML file (-o yaml). Donâ€™t create it(â€“dry-run)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run nginx --image&#x3D;nginx  --dry-run&#x3D;client -o yaml</span><br></pre></td></tr></table></figure>





<h4 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h4><p><strong>Create a deployment</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment --image&#x3D;nginx nginx</span><br></pre></td></tr></table></figure>



<p><strong>Generate Deployment YAML file (-o yaml). Donâ€™t create it(â€“dry-run)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment --image&#x3D;nginx nginx --dry-run -o yaml</span><br></pre></td></tr></table></figure>



<p><strong>Generate Deployment with 4 Replicas</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment nginx --image&#x3D;nginx --replicas&#x3D;4</span><br></pre></td></tr></table></figure>



<p>You can also scale(æ‰©å±•) a deployment using the <code>kubectl scale</code> command.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale deployment nginx --replicas&#x3D;4</span><br></pre></td></tr></table></figure>



<p><strong>Another way to do this is to save the YAML definition to a file.</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment nginx --image&#x3D;nginx--dry-run&#x3D;client -o yaml &gt; nginx-deployment.yaml</span><br></pre></td></tr></table></figure>

<p>You can then update the YAML file with the replicas or any other field before creating the deployment.</p>
<h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h4><p><strong>Create a Service named redis-service of type ClusterIP to expose pod redis on port 6379</strong>ï¼ˆ<strong>åˆ›å»ºä¸€ä¸ªåä¸ºredis-serviceçš„æœåŠ¡ï¼Œå…¶ç±»å‹ä¸ºClusterIPï¼Œåœ¨ç«¯å£6379ä¸Šå…¬å¼€pod redis</strong>ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose pod redis --port&#x3D;6379 --name redis-service --dry-run&#x3D;client -o yaml</span><br></pre></td></tr></table></figure>

<p>(This will automatically use the podâ€™s labels as selectors)ä¼šè‡ªåŠ¨æŠŠpodçš„labelä½œä¸ºselectors</p>
<p>Or</p>
<p><code>kubectl create service clusterip redis --tcp=6379:6379 --dry-run=client -o yaml</code>  (This will not use the pods labels as selectors, instead it will assume selectors as <strong>app=redis.</strong> <a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/issues/46191">You cannot pass in selectors as an option.</a> So it does not work very well if your pod has a different label set. So generate the file and modify the selectors before creating the service)</p>
<p><strong>Create a Service named nginx of type NodePort to expose pod nginxâ€™s port 80 on port 30080 on the nodes:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose pod nginx --port&#x3D;80 --name nginx-service --type&#x3D;NodePort --dry-run&#x3D;client -o yaml</span><br></pre></td></tr></table></figure>

<p>(This will automatically use the podâ€™s labels as selectors, but you cannot specify the node port. You have to generate a definition file and then add the node port in manually before creating the service with the pod.)</p>
<p>Or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create service nodeport nginx --tcp&#x3D;80:80 --node-port&#x3D;30080 --dry-run&#x3D;client -o yaml</span><br></pre></td></tr></table></figure>

<p>(This will not use the pods labels as selectors)</p>
<p>Both the above commands have their own challenges. While one of it cannot accept a selector the other cannot accept a node port. I would recommend going with the <code>kubectl expose</code> command. If you need to specify a node port, generate a definition file using the same command and manually input the nodeport before creating the service.</p>
<h3 id="Practise"><a href="#Practise" class="headerlink" title="Practise"></a>Practise</h3><ul>
<li><p>Create a new pod called <code>custom-nginx</code> using the <code>nginx</code> image and expose it on <code>container port</code> <code>8080</code></p>
<p><code>kubectl run custom-nginx --image=nginx --port=8080</code></p>
</li>
<li><p>Create a new deployment called <code>redis-deploy</code> in the <code>dev-ns</code> namespace with the <code>redis</code> image. It should have <code>2</code> replicas.</p>
<p><code>kubectl create deployment redis-deploy --image=redis --replicas=2 --namespace=dev-ns</code></p>
<p>æˆ–è€…ï¼š</p>
<p>Step 1: Create the deployment YAML file<br><code>kubectl create deployment redis-deploy --image redis --namespace=dev-ns --dry-run=client -o yaml &gt; deploy.yaml</code><br>Step 2: Edit the YAML file and add update the replicas to <code>2</code><br>Step 3: Run <code>kubectl apply -f deploy.yaml</code> to create the deployment in the <code>dev-ns</code> namespace.<br>You can also use <code>kubectl scale deployment or kubectl edit deployment</code> to change the number of replicas once the object has been created.</p>
</li>
<li><p>Create a pod called <code>httpd</code> using the image <code>httpd:alpine</code> in the default namespace. Next, create a service of type <code>ClusterIP</code> by the same name <code>(httpd)</code>. The target port for the service should be <code>80</code>.</p>
<p><code>kubectl run httpd --image=httpd:alpine </code></p>
<p><code>kubectl expose pod httpd --port=80 --name httpd --type=ClusterIP --dry-run=client -o yaml &gt; httpd-service.yaml</code></p>
<p><code>kubectl create -f httpd-service.yaml</code></p>
<p>æˆ–è€…ï¼š</p>
<p><code>kubectl run httpd --image=httpd:alpine --port 80 --expose</code></p>
<p>è‡ªåŠ¨åˆ›å»ºserviceå’Œpod</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en,default">
    <link itemprop="mainEntityOfPage" href="https://alstonzero.github.io/2020/11/24/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HOU YINGQIAO">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MyNote">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/24/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-24 22:38:36" itemprop="dateCreated datePublished" datetime="2020-11-24T22:38:36+10:00">2020-11-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en,default">
    <link itemprop="mainEntityOfPage" href="https://alstonzero.github.io/2020/11/24/k8s-Microservices-Architecture/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="HOU YINGQIAO">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MyNote">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/24/k8s-Microservices-Architecture/" class="post-title-link" itemprop="url">k8s_Microservices_Architecture</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-24 22:29:15" itemprop="dateCreated datePublished" datetime="2020-11-24T22:29:15+10:00">2020-11-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-31 00:09:49" itemprop="dateModified" datetime="2020-12-31T00:09:49+10:00">2020-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/k8s-udemy/" itemprop="url" rel="index"><span itemprop="name">k8s_udemy</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Microservices-Architecture"><a href="#Microservices-Architecture" class="headerlink" title="Microservices Architecture"></a>Microservices Architecture</h1><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><h4 id="é¦–å…ˆåˆ›å»ºPod"><a href="#é¦–å…ˆåˆ›å»ºPod" class="headerlink" title="é¦–å…ˆåˆ›å»ºPod"></a>é¦–å…ˆåˆ›å»ºPod</h4><ul>
<li><p>æŠ•ç¥¨app çš„pod</p>
<p><code>voting-app-pod.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">voting-app-pod</span>  <span class="comment">#pod name</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">voting-app-pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">voting-app</span> <span class="comment">#container name</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">kodekloud/examplevotingapp_vote:v1</span> </span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span> <span class="comment">#the port on which the application listens for this voting app</span></span><br><span class="line">          </span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦ç”¨containerPortå±æ€§ä¸ºvoting applicationæ˜ç¡®æŒ‡å®šport</p>
</li>
<li><p>result appçš„Pod</p>
<p><code>result-app-pod.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">result-app-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">result-app-pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">result-app</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">kodekloud/examplevotingapp_result:v1</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>redisçš„Pod</p>
<p><code>redis-pod.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">redis-pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>postgresçš„Pod</p>
<p><code>postgres-pod.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">  <span class="attr">name:</span> <span class="string">postgres-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">postgres-pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">contianers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">postgres</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">postgres</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5432</span></span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POSTGRES_USER</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;postgres&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POSTGRES_PASSWORD</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;postgres&quot;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>workerçš„Pod</p>
<p><code>worker-app-pod.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">worker-app-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">worker-app-pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">worker-app</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">kodekloud/examplevotingapp_worker:v1</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="åˆ›å»ºservice"><a href="#åˆ›å»ºservice" class="headerlink" title="åˆ›å»ºservice"></a>åˆ›å»ºservice</h4><ul>
<li><p>redisçš„service (voting-appçš„Podè¿æ¥è¯¥service)</p>
<p><code>redis-service.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis</span> <span class="comment">#voting-appæºç é‡Œé¢è¦è¿æ¥çš„æ•°æ®åº“ä¸ºredisï¼Œå› æ­¤è¿™é‡Œå‘½åä¸ºredis</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">redis-service</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">6379</span> <span class="comment">#serviceæš´éœ²ç»™å…¶ä»–è¿æ¥çš„port</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">6379</span> <span class="comment">#serviceè¦è¿æ¥çš„redisçš„Podçš„port</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment">#link the service to the Pod</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">redis-pod</span> <span class="comment">#redis Podçš„label</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>postgresçš„service ï¼ˆresult-appçš„Podè¿æ¥è¯¥serviceï¼‰</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">db</span> <span class="comment">#result-appæºç é‡Œé¢è¿æ¥çš„æ•°æ®åº“åç§°å«dbï¼Œå› æ­¤serviceè¦å‘½åä¸ºdb</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">postgre-service</span> <span class="comment">#éšæ„å®šä¹‰</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">5432</span> </span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">5432</span> </span><br><span class="line">  <span class="attr">selector:</span> <span class="comment">#link the service to the Pod</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">postgres-pod</span> <span class="comment">#è¦è¿æ¥çš„postgre Podçš„labels</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>voting-appçš„service ï¼ˆç”¨æˆ·ä»å¤–é¢è¿æ¥è¯¥serviceï¼‰</p>
<p><code>voting-app-service.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">result-service</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">voting-service</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span> <span class="comment">#è¿™é‡Œé€‰æ‹©NodePortï¼Œå› ä¸ºè¦æš´éœ²ç»™å¤–é¢ç”¨æˆ·ä½¿ç”¨</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30004</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment">#voting-appçš„Podçš„labels</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">voting-app-pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>result-appçš„service</p>
<p><code>result-app-service.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">result-service</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">result-service</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30005</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment">#result-appçš„Podçš„labels</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">result-app-pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h4 id="å¯åŠ¨Podå’ŒService"><a href="#å¯åŠ¨Podå’ŒService" class="headerlink" title="å¯åŠ¨Podå’ŒService"></a>å¯åŠ¨Podå’ŒService</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods,svc</span><br></pre></td></tr></table></figure>



<h3 id="ä½¿ç”¨Deploymentæ¥åˆ›å»ºk8så¾®æœåŠ¡"><a href="#ä½¿ç”¨Deploymentæ¥åˆ›å»ºk8så¾®æœåŠ¡" class="headerlink" title="ä½¿ç”¨Deploymentæ¥åˆ›å»ºk8så¾®æœåŠ¡"></a>ä½¿ç”¨Deploymentæ¥åˆ›å»ºk8så¾®æœåŠ¡</h3><p><img src="C:\Users\alston\AppData\Roaming\Typora\typora-user-images\1606112620439.png" alt="1606112620439"></p>
<p>ç”¨åˆ›å»ºä¸€ä¸ªä¸ªPodçš„æ–¹æ³•å¹¶ä¸èƒ½å®ç°Podçš„æ‰©å®¹ï¼ˆscale upï¼‰ï¼Œä½†é€‰æ‹©Deploymentèƒ½å¸®åŠ©æˆ‘ä»¬å®ç°ï¼ŒreplicaSetï¼Œrolling update,rollbackç­‰åŠŸèƒ½</p>
<p>å°†ä¸Šé¢ä¾‹å­ä¸­podçš„å®šä¹‰æ–‡ä»¶æ”¹å†™æˆDeploymentçš„å®šä¹‰æ–‡ä»¶ã€‚</p>
<ul>
<li><p>voting-appçš„Deployment æ–‡ä»¶</p>
</li>
<li><p><code>voting-app-deployment.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">voting-app-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">voting-app-deploy</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment">#podçš„labels</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">voting-app-pod</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">voting-app-pod</span>  <span class="comment">#pod name</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">voting-app-pod</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">voting-app</span> <span class="comment">#container name</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">kodekloud/examplevotingapp_vote:v1</span> </span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">           <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span> </span><br></pre></td></tr></table></figure>
</li>
<li><p><code>result-app-deployment.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">result-app-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">result-app-deploy</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment">#podçš„labels</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">result-app-pod</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">result-app-pod</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">result-app-pod</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">result-app</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">kodekloud/examplevotingapp_result:v1</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span> </span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>redisçš„Deployment</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">redis-deploy</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment">#podçš„labels</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">redis-pod</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">demo-voting-appp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span> </span><br><span class="line">      <span class="attr">name:</span> <span class="string">redis-pod</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis-pod</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">           <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>postgres-deploy.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">postgres-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">postgres-deploy</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment">#podçš„labels</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">postgres-pod</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span> </span><br><span class="line">      <span class="attr">name:</span> <span class="string">postgres-pod</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">postgres-pod</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">postgres</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">postgres</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5432</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">           <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POSTGRES_USER</span></span><br><span class="line">             <span class="attr">value:</span> <span class="string">&quot;postgres&quot;</span></span><br><span class="line">           <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POSTGRES_PASSWORD</span></span><br><span class="line">             <span class="attr">value:</span> <span class="string">&quot;postgres&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>worker-app-deploy.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">worker-app-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">worker-app-deploy</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment">#podçš„labels</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">worker-app-pod</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">worker-app-pod</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">worker-app-pod</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">demo-voting-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">worker-app</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">kodekloud/examplevotingapp_worker:v1</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>ä¾æ¬¡åˆ›å»ºdeploymentå’ŒService</p>
<p><code>kubectl create -f  voting-app-deployment.yaml</code></p>
<p><code>kubectl create -f voting-app-service.yaml</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">HOU YINGQIAO</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/alstonzero" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;alstonzero" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://qiita.com/alstonzero" title="Qiita â†’ https:&#x2F;&#x2F;qiita.com&#x2F;alstonzero" rel="noopener" target="_blank"><i class="qiita fa-fw"></i>Qiita</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://linux.51yip.com/" title="http:&#x2F;&#x2F;linux.51yip.com&#x2F;" rel="noopener" target="_blank">Linuxå‘½ä»¤æ‰‹å†Œ</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HOU YINGQIAO</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
